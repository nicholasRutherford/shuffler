<!DOCTYPE html>
<html>
  <head>
    <title>Card Shuffler</title>
    <style>
      body {
        margin: 0;
        height: 100vh;
        display: flex;
        flex-direction: column;
        font-family: Arial, sans-serif;
        touch-action: manipulation;
        user-select: none;
      }

      #grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        grid-template-rows: repeat(3, 1fr);
        height: 100%;
        gap: 4px;
        padding: 4px;
        background: #f0f0f0;
      }

      .cell {
        background: #ddd;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        transition: background-color 0.3s;
      }

      .active {
        background: #4caf50;
        color: white;
      }

      #center {
        background: #999;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        text-align: center;
        padding: 10px;
        gap: 10px;
      }

      #speedControl {
        width: 80%;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
      }

      #speedSlider {
        width: 100%;
      }

      #controls {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 20px;
        background: rgba(255, 255, 255, 0.9);
        display: flex;
        justify-content: center;
        gap: 10px;
      }

      button {
        padding: 10px 20px;
        font-size: 18px;
        border: none;
        border-radius: 5px;
        background: #2196f3;
        color: white;
        cursor: pointer;
      }

      button:active {
        background: #1976d2;
      }

      .playing {
        background: #f44336;
      }
    </style>
  </head>
  <body>
    <div id="grid">
      <div class="cell" data-pos="NW">↖️</div>
      <div class="cell" data-pos="N">⬆️</div>
      <div class="cell" data-pos="NE">↗️</div>
      <div class="cell" data-pos="W">⬅️</div>
      <div id="center">
        <div id="speedControl">
          <input
            type="range"
            id="speedSlider"
            min="200"
            max="2000"
            value="1000"
            step="100"
          />
          <span id="speedLabel">1 second</span>
        </div>
        <button id="playPauseBtn">Start Auto</button>
      </div>
      <div class="cell" data-pos="E">➡️</div>
      <div class="cell" data-pos="SW">↙️</div>
      <div class="cell" data-pos="S">⬇️</div>
      <div class="cell" data-pos="SE">↘️</div>
    </div>

    <script>
      const positions = ["NW", "N", "NE", "W", "E", "SW", "S", "SE"];
      let intervalId = null;
      const playPauseBtn = document.getElementById("playPauseBtn");
      const speedSlider = document.getElementById("speedSlider");
      const speedLabel = document.getElementById("speedLabel");

      function getRandomPosition() {
        let randomIndex = Math.floor(Math.random() * positions.length);
        let position = positions[randomIndex];
        return position;
      }

      function highlightPosition(position) {
        document.querySelectorAll(".cell").forEach((cell) => {
          cell.classList.remove("active");
        });

        if (position) {
          document
            .querySelector(`[data-pos="${position}"]`)
            .classList.add("active");
        }
      }

      function updateSpeedLabel(value) {
        const seconds = value / 1000;
        speedLabel.textContent = `${seconds} second${seconds !== 1 ? "s" : ""}`;
      }

      function toggleAutoPlay() {
        if (intervalId) {
          clearInterval(intervalId);
          intervalId = null;
          playPauseBtn.textContent = "Start Auto";
          playPauseBtn.classList.remove("playing");
        } else {
          playPauseBtn.textContent = "Stop Auto";
          playPauseBtn.classList.add("playing");
          // Trigger once immediately
          highlightPosition(getRandomPosition());
          // Then start the interval
          intervalId = setInterval(() => {
            highlightPosition(getRandomPosition());
          }, speedSlider.value);
        }
      }

      playPauseBtn.addEventListener("click", toggleAutoPlay);

      speedSlider.addEventListener("input", (e) => {
        updateSpeedLabel(e.target.value);
        if (intervalId) {
          clearInterval(intervalId);
          intervalId = setInterval(() => {
            highlightPosition(getRandomPosition());
          }, e.target.value);
        }
      });

      // Initialize speed label
      updateSpeedLabel(speedSlider.value);

      // Enable manual advancement by tapping anywhere except controls
      document.body.addEventListener("click", (e) => {
        if (
          e.target.tagName !== "BUTTON" &&
          e.target.tagName !== "INPUT" &&
          !intervalId
        ) {
          highlightPosition(getRandomPosition());
        }
      });
    </script>
  </body>
</html>
